(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{77:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var l=t(5155),a=t(2115);function s(e){let{onComplete:r}=e,[t,s]=(0,a.useState)(5),[n,d]=(0,a.useState)("불안");return(0,l.jsxs)("div",{className:"max-w-md mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Check-in"}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({intensity:t,emotion:n})},className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-3",children:["지금 콜드콜 생각하면 얼마나 부담스럽나요?",(0,l.jsxs)("span",{className:"ml-2 text-blue-600 dark:text-blue-400",children:[t,"/10"]})]}),(0,l.jsx)("input",{type:"range",min:"0",max:"10",value:t,onChange:e=>s(Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),(0,l.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,l.jsx)("span",{children:"전혀 아님"}),(0,l.jsx)("span",{children:"매우 부담스러움"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-3",children:"현재 감정 상태는?"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3",children:["불안","귀찮음","짜증","기대"].map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>d(e),className:"px-4 py-3 rounded-lg border-2 transition-all ".concat(n===e?"border-blue-600 bg-blue-50 dark:bg-blue-900 dark:border-blue-400 text-blue-600 dark:text-blue-400 font-semibold":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"),children:e},e))})]}),(0,l.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"다음 단계로"})]})]})}function n(e){let{onStart:r}=e,[t,s]=(0,a.useState)("busy_public_officer"),[n,d]=(0,a.useState)("light");return(0,l.jsxs)("div",{className:"max-w-md mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Scenario Setup"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-3",children:"클라이언트 유형"}),(0,l.jsx)("select",{value:t,onChange:e=>s(e.target.value),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[{value:"busy_public_officer",label:"바쁜 공공기관 담당자"},{value:"cold_startup_ceo",label:"냉담한 스타트업 CEO"},{value:"defensive_manager",label:"방어적인 관리자"}].map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-3",children:"난이도"}),(0,l.jsx)("div",{className:"space-y-2",children:[{value:"light",label:"쉬움",desc:"친절하고 반응이 좋음"},{value:"mid",label:"보통",desc:"일반적인 반응"},{value:"hard",label:"어려움",desc:"적대적이고 회피적"}].map(e=>(0,l.jsxs)("label",{className:"flex items-center p-3 rounded-lg border-2 cursor-pointer transition-all ".concat(n===e.value?"border-blue-600 bg-blue-50 dark:bg-blue-900 dark:border-blue-400":"border-gray-300 dark:border-gray-600 hover:border-gray-400"),children:[(0,l.jsx)("input",{type:"radio",name:"difficulty",value:e.value,checked:n===e.value,onChange:e=>d(e.target.value),className:"mr-3"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium",children:e.label}),(0,l.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.desc})]})]},e.value))})]}),(0,l.jsx)("button",{onClick:()=>{r({clientType:t,difficulty:n})},className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"통화 시작하기"})]})]})}function d(e){let{sessionConfig:r,preEmotion:t,onFinish:s}=e,[n,d]=(0,a.useState)([]),[o,c]=(0,a.useState)(!1),[i,u]=(0,a.useState)(!1),[b,x]=(0,a.useState)(0),[m,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!0),[y,f]=(0,a.useState)(""),j=(0,a.useRef)(null),v=(0,a.useRef)(null),k=(0,a.useRef)(Date.now()),N=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return void p(!1);let r=new e;return r.lang="ko-KR",r.continuous=!0,r.interimResults=!1,r.onresult=e=>{let r=Array.from(e.results).map(e=>e[0].transcript).join(" ");r.trim()&&w(r)},r.onerror=e=>{console.error("Speech recognition error:",e.error),u(!1)},r.onend=()=>{o&&!m&&setTimeout(()=>{o&&r.start()},100)},j.current=r,v.current=window.speechSynthesis,N.current=setInterval(()=>{x(Math.floor((Date.now()-k.current)/1e3))},1e3),()=>{N.current&&clearInterval(N.current),r.stop()}},[]);let w=async e=>{if(!e.trim())return;g(!0);let t={role:"user",content:e,timestamp:new Date};d(e=>[...e,t]);try{let l=await fetch("/api/call",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationHistory:[...n,t],currentUserMessage:e,clientType:r.clientType,difficulty:r.difficulty})});if(!l.ok)throw Error("API call failed");let a=await l.json(),s={role:"client",content:a.message,timestamp:new Date};if(d(e=>[...e,s]),v.current){let e=new SpeechSynthesisUtterance(a.message);e.lang="ko-KR",v.current.speak(e)}}catch(r){console.error("Error calling API:",r);let e={role:"client",content:"죄송합니다. 처리 중 오류가 발생했습니다.",timestamp:new Date};d(r=>[...r,e])}finally{g(!1)}};return(0,l.jsxs)("div",{className:"max-w-4xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"통화 중"}),(0,l.jsx)("div",{className:"text-2xl font-mono font-semibold",children:(e=>{let r=Math.floor(e/60);return"".concat(r.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(b)})]}),!h&&(0,l.jsxs)("div",{className:"mb-4 p-4 bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg",children:[(0,l.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 mb-2",children:"음성 인식이 지원되지 않습니다. 텍스트로 입력해주세요."}),(0,l.jsx)("input",{type:"text",value:y,onChange:e=>f(e.target.value),onKeyPress:e=>{"Enter"===e.key&&y.trim()&&(w(y),f(""))},placeholder:"메시지를 입력하고 Enter를 누르세요",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg"})]}),(0,l.jsx)("div",{className:"mb-6 h-96 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-lg p-4 bg-gray-50 dark:bg-gray-900",children:0===n.length?(0,l.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"통화가 시작되었습니다. 마이크 버튼을 눌러 말씀하세요."}):(0,l.jsxs)("div",{className:"space-y-4",children:[n.map((e,r)=>(0,l.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,l.jsxs)("div",{className:"max-w-[80%] px-4 py-2 rounded-lg ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-100"),children:[(0,l.jsx)("p",{className:"text-sm font-medium mb-1",children:"user"===e.role?"나":"클라이언트"}),(0,l.jsx)("p",{className:"whitespace-pre-wrap",children:e.content})]})},r)),m&&(0,l.jsx)("div",{className:"flex justify-start",children:(0,l.jsx)("div",{className:"bg-gray-200 dark:bg-gray-700 px-4 py-2 rounded-lg",children:(0,l.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"응답 대기 중..."})})})]})}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("button",{onClick:()=>{if(!h){y.trim()&&(w(y),f(""));return}let e=j.current;e&&(o?(e.stop(),c(!1),u(!1)):(e.start(),c(!0),u(!0)))},disabled:m,className:"flex-1 py-3 px-6 rounded-lg font-semibold transition-colors ".concat(o?"bg-red-600 hover:bg-red-700 text-white":"bg-green-600 hover:bg-green-700 text-white"," disabled:opacity-50 disabled:cursor-not-allowed"),children:o?"\uD83C\uDFA4 마이크 끄기":"\uD83C\uDFA4 Hold to Talk"}),(0,l.jsx)("button",{onClick:()=>{j.current&&j.current.stop(),v.current&&v.current.cancel(),N.current&&clearInterval(N.current),s({messages:n,duration:b,preEmotion:t,sessionConfig:r})},className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"통화 종료"})]})]})}var o=t(2619),c=t.n(o);function i(e){let{report:r,onRetry:t}=e,a=e=>e>=8?"text-green-600 dark:text-green-400":e>=6?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",s=e=>e>=8?"bg-green-100 dark:bg-green-900":e>=6?"bg-yellow-100 dark:bg-yellow-900":"bg-red-100 dark:bg-red-900";return(0,l.jsxs)("div",{className:"max-w-2xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[(0,l.jsx)("h2",{className:"text-3xl font-bold mb-8",children:"피드백 리포트"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,l.jsxs)("div",{className:"p-6 rounded-lg ".concat(s(r.ers)),children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"ERS"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Emotional Resilience Score"}),(0,l.jsxs)("div",{className:"text-4xl font-bold ".concat(a(r.ers)),children:[r.ers.toFixed(1),"/10"]})]}),(0,l.jsxs)("div",{className:"p-6 rounded-lg ".concat(s(r.ls)),children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"LS"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Logic/Structure Score"}),(0,l.jsxs)("div",{className:"text-4xl font-bold ".concat(a(r.ls)),children:[r.ls.toFixed(1),"/10"]})]})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-3",children:"피드백"}),(0,l.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-lg",children:(0,l.jsx)("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-line",children:r.summary})})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold mb-3",children:"다음 목표"}),(0,l.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900 p-4 rounded-lg border-l-4 border-blue-600 dark:border-blue-400",children:(0,l.jsx)("p",{className:"text-blue-900 dark:text-blue-100 font-medium",children:r.nextGoal})})]}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)(c(),{href:"/",className:"flex-1 text-center bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-semibold py-3 px-6 rounded-lg transition-colors",children:"돌아가기(홈)"}),(0,l.jsx)("button",{onClick:t,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"다시 연습하기"})]})]})}function u(){let[e,r]=(0,a.useState)("checkin"),[t,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[b,x]=(0,a.useState)(null),[m,g]=(0,a.useState)(null),h=async e=>{x(e);try{let t=await fetch("/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({callLog:e})});if(!t.ok)throw Error("Feedback API failed");let l=await t.json();g(l.report),r("feedback")}catch(e){console.error("Error getting feedback:",e),g({ers:7,ls:7,summary:"피드백을 생성하는 중 오류가 발생했습니다. 다시 시도해주세요.",nextGoal:"통화를 다시 연습해보세요."}),r("feedback")}};return(0,l.jsx)("main",{className:"min-h-screen p-4 md:p-8",children:(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:["checkin"===e&&(0,l.jsx)(s,{onComplete:e=>{o(e),r("scenario")}}),"scenario"===e&&t&&(0,l.jsx)(n,{onStart:e=>{u(e),r("call")}}),"call"===e&&c&&t&&(0,l.jsx)(d,{sessionConfig:c,preEmotion:t,onFinish:h}),"feedback"===e&&m&&(0,l.jsx)(i,{report:m,onRetry:()=>{r("checkin"),o(null),u(null),x(null),g(null)}})]})})}},738:(e,r,t)=>{Promise.resolve().then(t.bind(t,77))}},e=>{e.O(0,[619,441,255,358],()=>e(e.s=738)),_N_E=e.O()}]);